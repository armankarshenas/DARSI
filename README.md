# DARSI (Deep Learning Adaptable Regulatory Sequence Identifier) package  
---
The DARSI package trains Convolutional Neural Networks for differential expression datasets generated by MPRAs. The trained models are capable of predicting expression level from raw DNA sequences and saliency maps are generated for each of the trained models to predict locations of binding sites. This README file briefly introduces the scripts and how they can be used. For a more comprehensive guideline, please see the comments in each of the scripts.

## Repository content
Description of the directories in these repositories are provided below:

1. **Data** - This directory contains the fasta files, txt files, and mat files that were used to train the models.   
2. **Plots** - This directory contains all of the confusion matrices and expression shift plots that were generated by the DARSI pipeline for the *E. coli* dataset. 
3. **Scripts** - This directory contains all the Matlab scripts that were implemented to 1. pre-process 2. classify and 3. generate saliency maps for the *E. coli* datasets in order to generate expression shift plots that can be used to identify the location of binding sites.
4. **PlottingScripts** - This directory contains all the Matlab scripts that were imeplemented to generate plots and figures.
5. **RNA-SeqProcessing** - This directory contains all the Jupyter notebooks that were used to filter and process raw sequencing data into the fasta and txt files that were used as inputs to the pipeline. 

## How to install the DARSI package 

The DARSI package can be easily installed by just cloning the repository onto your local host. You can run the following command to clone this repository in the current directory of your local computer: 

	 git clone https://github.com/armankarshenas/DARSI


## How to use the DARSI package 

The MPRAs used to investigate gene expression regulation are often a collection of thousands of mutated DNA sequences and the corresponding measure of gene expression activity. In order to be able to use these datasets with DARSI, the sequences need to be converted into binary images and the expression measurements need to be binned into discrete number of classes. The processed data is then used to train a CNN for each gene/operon in the dataset and the trained model is then used to 1) predict expression activity of *de-novo* sequences and 2) generate saliency maps and expression shifts that are used to identify the location of binding sites. 

Each of the following scripts starts with a specification section that should be edited in order for the package to have the correct paths to image datasets and the metadata. 

### Preprocessing 
---
Please use the following script to pre-process the sequences and RNA counts as needed before training the network: 

1. To convert the sequences into binary images and bin the expression levels into discrete classes, run the following script. 
		
    SequenceDataProcessing.m
		
### CNN training 
---

In order to train the CNN models based on the images generated by the pre-processing pipeline, please run one of the following scripts: (for MPRAs that have only one gene or one operon, run **DeepLearningAllGene.m**, however, if your dataset contains multiple operons/genes, run **DeepLearningSingleGene.m**)

1. DeepLearningSingleGene.m
2. DeepLearningAllGene.m


### Saliency map generation & binding site identification 
--- 

Many network structures have been developed in the past few years that can be used to segment or parse the image to sub-domains that are labelled. The process of labelling images to train a segmentation network is much more intensive, however, which is why only scripts for this were implemented but segmentation was not used on the cichlid data set. The two scripts below train two different segmentation architectures namely: U-net and Deeplabv3+ respectively.

	SemanticUNet.m
	SemanticDeepLabv3+.m 
